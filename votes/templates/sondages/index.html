{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>Sondage</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{%static 'css/main.min.css' %}">
    <link rel="stylesheet" href="{%static 'css/styleC.css' %}">
    <link rel="stylesheet" href="{%static 'css/responsive.css' %}">
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static '/vote/css/style.css' %}"
    />
  </head>
    
<body class="gradients">
    <input type="text"
      class="form-control" hidden value="{{ electeur.id_electeur }}" name="" id="electeur" >
  
  <header class="">
		<div class="topbar stick">
			<div class="logo"><img src="{% static 'img/Logo.png' %}" alt=""><span></span></div>
			<div class="searches">
				<form method="post">
					<input type="text" placeholder="Search...">
					<button type="submit"><i class="icofont-search"></i></button>
					<span class="cancel-search"><i class="icofont-close"></i></span>
					<div class="recent-search">
						<h4 class="recent-searches">Your's Recent Search</h4>
					</div>
				</form>
			</div>
			
			<ul class="web-elements">
				<li>
					<div class="user-dp" style="border: 1px solid rgb(2, 115, 20); background: rgb(224, 224, 224)">
						<a href="profile" title="" >
							<img alt="" src="images/resources/user.jpg">
							<div class="name" >
								{% comment %} <h4>{{user.username}}</h4> {% endcomment %}
								<h4>{{user.username}}</h4>
								{% comment %} <h4>{{user.groups.get}}</h4> {% endcomment %}
							</div>
						</a>	
					</div>
				</li>
				<li >
					<a style="border: 1px solid rgb(2, 115, 20); background: rgb(224, 224, 224)" class="mesg-notif" href="#" title="Notifications" data-toggle="tooltip">
						<i>
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></i>
					</a>
					<span></span>
				</li>
				<li>
					<a style="border: 1px solid rgb(2, 115, 20); background: rgb(224, 224, 224)" class="create" href="#" title="Add New" data-toggle="tooltip">
						<i>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></i>
					</a>
					<ul class="dropdown">
						<li><a href="#" title=""><i class="icofont-user-alt-3"></i> Mon Profil</a></li>
						<li class="logout"><a href="/" title=""><i class="icofont-power"></i> Logout</a></li>
					</ul>
				</li>
			</ul>
		</div>
		
	</header><!-- header -->

  <div style="display: flex;">
  <div class="zones ml-3 mt-4">
    {% if zones %}
      {% for commune in zones  %}
        <div class="mb-3">
          <a href="/vote/{{ commune.id_zone }}" class="btn-zone btn bg-white">{{ commune.nom_zone }}</a> 
        </div>
      {% endfor %}
    {% endif %}
  </div>
 
  <div class="tinder">
  <div class="tinder--status">
    <i class="fa fa-remove"></i>
    <i class="fa fa-heart"></i>
  </div>
  <div class="form-group">
    <label for=""></label>
    <input type="text"
      class="form-control" hidden name="" value="{{zone.id_zone}}" id="zone_courante" aria-describedby="helpId" placeholder="">
  </div>
  {% if reponses %}
  <div class="tinder--cards">
    <input type="text" hidden class="form-control" name="" value="{{ nbr }}" id="nbr" aria-describedby="helpId" placeholder="">
        <script>cpt = 0</script>
    {% for reponse in reponses %}
    <div class="tinder--card">
      <h3>{{ reponse.themes_cles.libelle_themes_cles }}</h3>
      <p>{{ reponse.libelle_proposition }}</p>
      <div class="form-group">
        <label for=""></label>
        
        <input type="text" hidden class="form-control vall{{ reponse.id_proposition }}" name="" id="" value="{{ reponse.id_proposition }}" aria-describedby="helpId" placeholder="">
        <input type="text" hidden class="form-control prop{{ reponse.id_proposition }}" name="" id="" value="{{ reponse.themes_cles.zone.id_zone }}" aria-describedby="helpId" placeholder="">
        <input type="text" hidden class="form-control cand{{ reponse.id_proposition }}" name="" id="" value="{{ reponse.candidat.id_candidat }}" aria-describedby="helpId" placeholder="">
        
        <script>
            cpt++
            var monElement = document.querySelector(".vall{{ reponse.id_proposition }}");
            var monElement2 = document.querySelector(".prop{{ reponse.id_proposition }}");
            var monElement3 = document.querySelector(".cand{{ reponse.id_proposition }}");
            var valeyyy = "vale"+ cpt
            var valeyyy2 = "prop"+ cpt
            var valeyyy3 = "cand"+ cpt
            // Ajouter un ID à l'élément
            console.log(valeyyy)
            monElement.id = valeyyy;
            monElement2.id = valeyyy2;
            monElement3.id = valeyyy3;
            
        </script>
      </div>
    </div>
    <div class="tinder--buttons">
  </div>
    {% endfor %}
  </div>

  <div class="tinder--buttons">
    <button onclick="voteC()" id="nope"><i class="fa fa-remove"></i></button>
    <button onclick="voteP()" id="love"><i class="fa-regular fa-heart"></i></i></button>
  </div>
</div>
{% endif %}
<div id="monModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>Ceci est un modal.</p>
  </div>
</div>
</div>



<!-- The Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">{{ zone.nom_zone }}</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        {% if reponses %}
        Vous répondez actuelement au questions relative a la commune selectionnée
        {% else %}
        Pas de sondage pour cette zone
        {% endif %}
      </div>

    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

 <script src='https://hammerjs.github.io/dist/hammer.min.js'></script>
  </body>
  <script  src="{% static '/vote/js/index.js' %}"></script>
  <script src="" async defer></script>
  <script>
     $(document).ready(function() {
        // Affichez le modal
        $("#myModal").modal("show");
    });
    nbr = document.getElementById("nbr").value
    nbrC = 0
    zone_id= document.getElementById("zone_courante").value 
    electeur= document.getElementById("electeur").value
    console.log("electeur: "+electeur)
    function voteP() {
        
        nbr--
        console.log("Pour")
        nbrC++
        ff = document.getElementById("vale"+nbrC).value
        ff2 = document.getElementById("prop"+nbrC).value
        ff3 = document.getElementById("cand"+nbrC).value
        const donnees = {
            proposition: ff,
            zone: ff2,
            candidat: ff3,
            nature_vote: "Pour",
            electeur: 1
            // Ajoutez d'autres champs et valeurs ici
        };
        enregistrerDonnees(donnees)
        if(nbr==0){
            alert("Merci d'avoir participer au sondage") 
            window.location.href = "/vote/resultat/"+electeur;
        }
    }
    function voteC() {
        
        nbr--
        nbrC++
        console.log("Contre")
        ff = document.getElementById("vale"+nbrC).value
        ff2 = document.getElementById("prop"+nbrC).value
        ff3 = document.getElementById("cand"+nbrC).value
        const donnees = {
            proposition: ff,
            zone: ff2,
            candidat: ff3,
            nature_vote: "contre",
            electeur: 1
            // Ajoutez d'autres champs et valeurs ici
        };
        enregistrerDonnees(donnees)
        if(nbr==0){
            alert("Merci d'avoir participer au sondage") 
            window.location.href = "/vote/resultat/"+electeur;
        }
    }

    function enregistrerDonnees(donnees) {

        fetch('/vote/api/Vote/', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            // Ajoutez d'autres en-têtes si nécessaire
            },
            body: JSON.stringify(donnees)
        })
        .then(response => response.json())
        .then(data => {
            // Traitez la réponse du serveur si nécessaire
            console.log('Données enregistrées avec succès :', data);
        })
        .catch(error => {
            // Gérez les erreurs de requête
            console.error('Erreur lors de l\'enregistrement des données :', error);
        });
        }

  </script>
</html>
